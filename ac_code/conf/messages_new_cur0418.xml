<?xml version="1.0"?>
<!DOCTYPE protocol SYSTEM "messages.dtd">
<protocol>

 <msg_class name="ac">

 <!--AC_cmd:-->
  <message name="BIND_RC" id="1">
    <description> link="A2R" request check result
                  check rc bind_state broadcast serial code and ack
    </description>
    <field name="serial_code"   type="uint8[10]"/>
  </message>
  

 <!--AC_state:-->
  <message name="AIRCRAFT_BIND_STATE" id="101">
    <description> link="broadcast" 
                  message broadcase between xbee communication initial and binded
                  write in xbee.c
    </description>
    <field name="serial_code"   type="uint8[10]"/>
  </message>

  <message name="AIRCRAFT_INFO_STATE" id="102">
    <description> link="A2G",after bind, serial number,autopilot software 
                  engine_type : 1 = Electricity , 2 = Fuel, 3 = Hybrid
                  request AP check the result
                  send as ack in 2 state
    </description> 
    <field name="engine_type" type="uint8"/>
    <field name="max_voyage" type="uint16" unit="m"/>
    <field name="battery_capacity" type="int32" unit="mAh"/>
    <field name="pesticides_capacity" type="int16" unit="0.1L"/>
    <field name="spray_wide"   type="uint16" unit="cm"/>
    <field name="spray_height" type="uint16" unit="cm"/>
    <field name="max_flight_height"   type="uint16" unit="cm"/> 
    <field name="spray_concentration"   type="uint8" unit="ml/m2"/>
    <field name="max_flight_speed"   type="uint16" unit="cm/s"/>
    <field name="spray_flight_speed"   type="uint16" unit="cm/s"/>
    <field name="sn_and_sv"   type="char[30]"/>         
  </message>

  <message name="HEART_BEAT_AC_GCS_STATE" id="103">
    <description>link="A2G" ,request GCS check time_out of receive failling
                 var link_x include:GCS|RC|LC|reserve,every one use 4bits
                 devices_status and flight_status see document
                 flight_status:
                                 bit1: 0=on_ground;          1=in_flight
				 bit2: 0=auto_mode;          1=manual_mode
				 bit3: 0=normal_mission;     1=exception_mission
				 bit4: 0=home_mode;          1=others
				 bit5: 0=spray_stop;         1=spray_open
				 bit6: 0=others;             1=take_off
				 bit7: 0=others;             1=landing
				 bit8: 0=motors_locked;      1=motors_unlocked
				 bit9: 0=mainpower_off;      1=mainpower_on
				    other bits keep 0
				 
                 devices_status:
                                 bit1: 0=gyroscope_nofixed;           1=gyroscope_fixed
				 bit2: 0=accelerometer_nofixed;       1=accelerometer_fixed
				 bit3: 0=magnetoresistor_nofixed;     1=magnetoresistor_fixed
				 bit4: 0=GPS_nofixed;                 1=GPS_fixed;  
				 bit5: 0=DGPS_nofixed;                1=DGPS_fixed;
				 bit6: 0=sonar_nofixed;               1=sonar_fixed
				 bit7: 0=barometer_nofixed;           1=barometer_fixed
				 bit8: 0=radar_nofixed;               1=radar_fixed
				 bit9: 0=collision_device_nofixed;    1=collision_device_fixed
				 bit10:0=wireless_A2G_nofixed;        1=wireless_A2G_fixed
				 bit11:0=wireless_A2R_nofixed;        1=wireless_A2R_fixed
				 bit12:0=spray_device_nofixed;        1=spray_device_fixed
				 bit13:0=power_manager_nofixed;        1=power_manager_fixed
                    other bits keep 0
				 bit17:0=gyroscope_error;             1=gyroscope_ok
				 bit18:0=accelerometer_error;         1=accelerometer_ok
				 .....				    
				 	
    </description>
    <field name="sys_time" type="uint16" unit="s"/>
    <field name="link_gcs_quality" type="uint8" unit="percent"/>
    <field name="link_rc_quality" type="uint8" unit="percent"/>
    <field name="link_rssi" type="uint8" unit="percent"/>
    <field name="devices_status" type="uint32"/>
    <field name="flight_status" type="uint32"/>
    <field name="heading" type="float" unit="deg"/>
    <field name="speed" type="int16" unit="cm/s"/>
    <field name="pos_x" type="int32" unit="e3,m"/>
    <field name="pos_y" type="int32" unit="e3,m"/>
    <field name="pos_z" type="int32" unit="e3,m"/>
    <field name="pos_lng" type="int32" unit="e7,deg"/>
    <field name="pos_lat" type="int32" unit="e7,deg"/>
    <field name="battery_remain"  type="int8"  unit="percent"/>
    <field name="pesticides_remain" type="int8" unit="percent"/>
    <field name="error_code" type="int16"/>
  </message>

  <message name="CURRENT_MISSION_STATE" id="104">
    <description>link="A2G"
                 trigger,when enter or run over the mission.
    </description>
    <field name="sys_time" type="uint16" unit="s"/>
    <field name="path_id" type="uint8"/>
    <field name="mission_id" type="uint8"/>
    <field name="mission_status" type="uint8"/>
  </message>

  <message name="MISSION_ACK_STATE" id="105">
    <description>link="A2G" use to ack the gcs mission messages
                            mission_ack_type: add = 0, update = 1, delete = 2, get = 3
                            0=success, others=error_code
    </description>
    <field name="mission_ack_code" type="uint8"/>
    <field name="mission_ack_type" type="uint8"/>
    <field name="mission_id" type="uint8"/>
    <field name="response" type="int8"/>    
  </message>

  <message name="MISSION_GET_ACK_STATE" id="106">
    <description>link="A2G" use to ack the gcs mission messages
                  wp_type: wgs84 = 1, relative = 0
    </description>
    <field name="mission_id" type="uint8"/>
    <field name="mission_type" type="uint8"/>  
    <field name="mission_status" type="uint8"/>          
    <field name="nb_wp" type="int8"/>
    <field name="nb_backup_land" type="int8"/>
    <field name="duration" type="uint8" unit="s"/>
    <field name="wp_type" type="uint8" />
    <field name="waypoints" type="int32[]"/> 
  </message>
  
  <message name="EXCEPTION_MISSION_STATE" id="107">
    <description>link="A2G" exception_mission_type: 1=hover,2=home_emergency,3=land_reserve,4=land_force,5=run_out
                 enmergency,trigger 
    </description>
    <field name="sys_time" type="uint16" unit="s"/>
    <field name="exception_mission_type" type="uint8"/>
    <field name="exception_mission_id" type="uint8"/>
  </message>

  <message name="MANUAL_MISSION_STATE" id="108">
    <description>link="A2G" descript manual action,manual_mission: 1=cruise,2=home(rc cmd),3=take_off,4=land,5=ground(locked)
                 if aircraft in manual_mode, it will trigger.
    </description>
    <field name="sys_time" type="uint16" unit="s"/>
    <field name="manual_mission_type" type="uint8"/>
    <field name="manual_mission_id" type="uint8"/>
  </message>

  <message name="SET_COMMAND_ACK_STATE" id="109">
    <description>link="A2G" use to ack the gcs SET_COMMAND messages 0=success, others=error_code
    </description>
    <field name="command_id" type="uint8"/>
    <field name="response"     type="int8"/>    
  </message>

  <!-- =============== RC ack============= -->

  <message name="HEART_BEAT_AC_RC_STATE" id="110">
    <description>link="A2R" ,use ack RC heartbeat message
                 period=1s if battery/pesticides parameter=-1,meant get the information fail
                 last_response=response of message "RC_SET_CMD_ACK_STATE"
                 use ack AC heart_beat message
    </description>
    <field name="sys_time" type="uint16" unit="s"/>
    <field name="ac_state" type="uint8" values="ground|flight"/>
    <field name="flight_mode"       type="uint8" values="kill|manual|auto"/>
    <field name="battery_remain"  type="uint8"  unit="percent"/>
    <field name="pesticides_remain" type="uint8" unit="percent"/>
    <field name="pesticides_threshold"   type="uint8"/>
    <field name="home_state"        type="uint8" values="stop_home|home"/>
    <field name="lock_state"        type="uint8" values="unlocked|locked"/>
    <field name="ac_ready"          type="uint8" values="unready|ready"/>
    <field name="error_code"        type="uint8" />
    <field name="alert_grade"       type="uint8" values="ok|low|medium|high"/>
    <field name="spray_state"       type="uint8" values="stop|open" />
  </message>

  <message name="RC_MOTION_CMD_ACK_STATE" id="111">
    <description>reserve!!!   link="A2R" 
                 ack the message "RC_MOTION_CMD" with response
                 0=success, others=error_code
    </description>
    <field name="reponse" type="uint8"/>
  </message>

  <message name="RC_SET_CMD_ACK_STATE" id="112">
    <description>reserve!!!   link="A2R" 
                 ack the message "RC_SET_CMD" with response                 
         <!--response=0B(abcd efgh),8bits                         -->
         <!--a: flight mode,    0 auto_mode,     1 manual_mode    -->
         <!--b: spray control   0 stop_spray,    1 open spray     -->
         <!--cd:VTOL            0 other,   1 takeoff, 2 land      -->
         <!--e :home mode       0 home,    1 not_home             -->
         <!--f: mainpower       0 turn off,1 turn on              -->
         <!--h: current_cmd ack 0 fail,    1 success              -->
         <!--g: reserve         0 default                         -->
    </description>
    <field name="reponse" type="uint8"/>
  </message>

  <message name="DATA_TEST" id="200">
    <description>link="A2G"
    </description>
    <field name="u8" type="uint8"/>
    <field name="s8" type="int8"/>
    <field name="u16" type="uint16"/>
    <field name="s16" type="int16"/>
    <field name="u32" type="uint32"/>
    <field name="s32" type="int32"/>
    <field name="f" type="float"/>
    <field name="s3" type="int8[]"/>
    <field name="f3" type="float[]"/>
  </message>

 </msg_class>


 <msg_class name="gcs">
  
  <!--GCS_cmd:-->
  <message name="SET_CONFIG" id="1">
    <description>link="G2A" 1:spray_height,cm; 2:spray_wide,cm; 3:spray_concentration,ml/m2; 
      4:spray_speed(recommand),cm/s; 5:max_flight_speed,cm/s; 6:max_flight_height,cm
                 aircraft will ack "AIRCRAFT_INFO_STATE" message
    </description>
    <field name="parameter_id" type="uint8"/>
    <field name="parameter_value" type="int8[]"/>
  </message>  

  <message name="SET_COMMAND" id="2">
    <description>link="G2A" id:1=delete all mission, value=null
                               2=request "AIRCRAFT_INFO_STATE" message, value=null
                 aircraft will ack with "SET_COMMAND_ACK_STATE" message
    </description>
    <field name="command_id" type="uint8"/>
    <field name="command_value" type="int8[]"/>
  </message>
  
  <message name="ADD_MISSION" id="3">
    <description>link="G2A" mission_type  0:flight_path; 1:spray_normal; 2.spray_insert; 3:normal_home_land;
	                  //high priority 4:hover; 5:emergency_home_land; 6:land_reserve; 7:land_force
	                        mission_status: 0=ready, 1=running, 2=success_done, 3=fail_done, 4=pause, 5=stop
	                        nb_backup_land(number of reserve land)
                                wp_type: wgs84 = 1, releative = 0
	                        in spray_insert mode,insert_wp is ahead of the spray area
                 aircraft will ack with "MISSION_ACK_STATE" message
    </description>
    <field name="mission_id" type="uint8"/>
    <field name="mission_type" type="uint8"/>    
    <field name="mission_ack_code" type="uint8"/>   
    <field name="mission_status" type="uint8"/>     
    <field name="nb_wp" type="int8"/>
    <field name="nb_backup_land" type="int8"/>      
    <field name="duration" type="uint8" unit="s"/>
    <field name="wp_type" type="uint8" />
    <field name="waypoints" type="int32[]"/>  
    <!-- in spray_insert mode,insert_wp is ahead of the spray area -->
    <!-- <field name="backuplandpoints" type="uint32[2]"/> -->
  </message>

  <message name="UPDATE_MISSION" id="4">
    <description>link="G2A" if nb_wp and nb_backup_land =0, mean only update status/duration
                 When the nb_wp = -1 and nb_backup_land = -1, we won't change the waypoints
                 aircraft will ack with "MISSION_ACK_STATE" message
    </description>
    <field name="mission_id" type="uint8"/>
    <field name="mission_type" type="uint8"/>  
    <field name="mission_ack_code" type="uint8"/>      
    <field name="mission_status" type="uint8"/>  
    <field name="nb_wp" type="int8"/>
    <field name="nb_backup_land" type="int8"/>   
    <field name="duration" type="uint8" unit="s"/>
    <field name="wp_type" type="uint8" />
    <field name="waypoints" type="int32[]"/>   
  </message>

  <message name="DELETE_MISSION" id="5">
    <description>link="G2A"
                 aircraft will ack with "MISSION_ACK_STATE" message
    </description>
    <field name="mission_id" type="uint8"/>
    <field name="mission_ack_code" type="uint8"/>
  </message>

  <message name="GET_MISSION" id="6">
    <description>link="G2A"
                 aircraft will ack with "MISSION_GET_ACK_STATE" message
    </description>
    <field name="mission_id" type="uint8"/>
    <field name="wp_type" type="uint8" />
  </message>

  <message name="BIND_AIRCRAFT" id="7">
    <description>link="G2A"
                aircraft will ack with "AIRCRAFT_INFO_STATE" message
    </description>
    <field name="serial_code" type="uint8[10]"/>
  </message>

										  
<!--GCS_state:-->
  <message name="HEART_BEAT_GCS_STATE" id="101">
    <description>link="G2A"
                 when gcs lost ac_heart_beat message,it will trigger
    </description>
    <field name="cur_mission_id" type="uint8"/>
  </message> 

 </msg_class>


 <msg_class name="rc">

  <!--RC_cmd:-->
  <message name="RC_MOTION_CMD" id="1">
    <description>link="R2A"
         <!--8bits:abcd efgh                     -->
         <!-- abcd=0001: virtical control        -->
         <!-- abcd=0010: for/back_ward control   -->
         <!-- abcd=0100: right/left_side control -->
         <!-- abcd=1000: rotation control        -->
         <!-- abcd=0000: horizontal control stop -->
         <!-- ef=01    : present orientation (up,  forward, right,clockwise)       -->
         <!-- ef=10    : present orientation (down,backward,left, counterclockwise)-->
         <!-- ef=00    : present orientation (stop status)                         -->
         <!-- gh=xx    : present control speed grade(00/01)                  -->
         <!--forward  00100101 37-->  
         <!--backward 00101001 0x41--> 
         <!--right    01000101 0x69--> 
         <!--left     01001001 0x73--> 
         <!--up       00010101 0x21--> 
         <!--down     00011001 0x25--> 
         <!--stop     00010000 0x16--> 
         <!--r_turn   10000101 0x133--> 
         <!--l_turn   10001001 0x137--> 
         <!--hover    00000000 0x00 --> 
    </description>
    <field name="motion_cmd"  type="uint8"/>
  </message>
  
  <message name="RC_SET_CMD" id="2">
    <description>link="R2A"
         <!--8bits:abcd efgh                                            -->
         <!--reserve  flight_mode:        set_auto  =0x10;    set_manual =0x01   -->
         <!--change   spray control:      add_spray=0x20;     reduce_spray =0x02 -->
         <!--keep     VTOL  control:      (take_off  =0x30;)  land       =0x03   -->
         <!--keep     home_mode:          home      =0x40;    stop_home  =0x04   -->
         <!--reserve  mainpower control:  mainpower_on=0x50;  mainpower_off=0x05 -->
         <!--add      lock control:       unlock=0x60;        lock=0x06          -->          


         <!--land      0x03--> 
         <!--add    spray 0x20-->
         <!--reduce spray 0x02-->
         <!--home   0x40(home)   0x04(stop home)-->
         <!--lock   0x60(unlock) 0x06(lock)  -->

         
    </description>
    <field name="set_cmd"  type="uint8"/>
  </message>


  <!--RC_state:-->
  <message name="RC_BIND_STATE" id="101">
    <description>link="broadcase" 
    </description>
    <field name="serial_code"   type="uint8[10]"/>
  </message>
  
  <message name="HEART_BEAT_RC_STATE" id="102">
    <description>link="R2A"
    </description>
    <field name="signal" type="uint8"/>
  </message>
  
 </msg_class>



 <msg_class name="lc">

  <message name="LC_BIND_STATE" id="101">
    <description>link="broadcase" 
    </description>
    <field name="serial_code"   type="uint8[10]"/>
  </message>
  
  <message name="HEART_BEAT_LC_STATE" id="102">
    <description>link="R2A"
    </description>
    <field name="signal" type="uint16"/>
  </message>
  
 </msg_class>
</protocol>
